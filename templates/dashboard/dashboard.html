{% extends "shared/base1.html" %}

{% block extra_head %}
  {{ super() }}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/base1.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
{% endblock %}

{% block content %}
{% if request.args.get("show_guide") == "true" %}

  <script>
    window.addEventListener("DOMContentLoaded", () => {
      const modal = new bootstrap.Modal(document.getElementById("welcomeModal"));
      modal.show();
    });
  </script>

  <div class="modal fade show" id="welcomeModal" tabindex="-1" aria-labelledby="welcomeModalLabel" aria-modal="true" style="display: block;">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="welcomeModalLabel">👋 Welcome to RentTracker!</h5>
        </div>
        <div class="modal-body text-dark">
          Start by adding your first <strong>Apartment</strong> and assigning a <strong>Tenant</strong>.<br><br>
          Once added, RentTracker will show unpaid rents and send reminders!
        </div>
        <div class="modal-footer d-flex flex-column align-items-start gap-2">
          <a href="{{ url_for('apartments.list_apartments') }}" class="btn btn-primary w-100">Add Apartment</a>
          <a href="{{ url_for('tenants.list_tenants') }}" class="btn btn-secondary w-100">Add Tenant</a>
          <a href="{{ url_for('rental_agreements.list_rental_agreements') }}" class="btn btn-primary w-100">Add Rental Agreement</a>
        </div>
      </div>
    </div>
  </div>
  <div class="modal-backdrop fade show"></div>

{% else %}

<!-- Cash-Flow Table -->
<div class="table-container">
  <h2 class="table-title">📊 Cash-Flow Projection</h2>
  <div class="table-actions-wrapper">
    <table class="styled-table">
      <thead>
        <tr>
          <th>Month</th>
          <th>Expected Income</th>
          <th>Collected Income</th>
          <th>Missing Income</th>
        </tr>
      </thead>
      <tbody>
        {% for row in projection %}
        <tr>
          <td>{{ row.month }}</td>
          <td>{{ row.expected }}€</td>
          <td>{{ row.collected }}€</td>
          <td>{{ row.missing }}€</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<!-- Info Boxes -->
<div class="d-flex justify-content-center flex-wrap my-5" style="gap: 3rem;">
  <div class="info-box pink-box text-center p-4">
    <h6 class="card-title text-dark mb-2">🏢 Total Apartments</h6>
    <div class="info-number">
      {{ total_apartments }}
    </div>
  </div>

  <div class="info-box blue-box text-center p-4">
    <h6 class="card-title text-dark mb-2">📄 Active Agreements</h6>
    <div class="info-number">
      {{ active_agreements }}
    </div>
  </div>
</div>

<!-- Upcoming/Unpaid Rent Overview Table -->
<div class="table-container">
  <h2 class="table-title">🔔 Upcoming/Unpaid Rent Overview</h2>

  {% if upcoming_unpaid %}
  <div class="table-actions-wrapper">
    <table class="styled-table">
      <thead>
        <tr>
          <th>Apartment</th>
          <th>Tenant</th>
          <th>Months to Pay</th>
          <th>Total Due</th>
        </tr>
      </thead>
      <tbody>
        {% for entry in upcoming_unpaid %}
        <tr>
          <td>{{ entry.apartment_name }}</td>
          <td>{{ entry.tenant_name }}</td>
          <td>
            {% for m in entry.months %}
              {{ m }}{% if not loop.last %}, {% endif %}
            {% endfor %}
          </td>
          <td><strong>{{ entry.total_due }}</strong></td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
    <p class="text-dark">✅ All rents appear to be paid for the relevant periods.</p>
  {% endif %}
</div>

{% endif %}
{% endblock %}