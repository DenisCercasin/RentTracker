{% extends "base.html" %}
{% block content %}

{% if request.args.get("show_guide") == "true" %}
  <!-- If the user comes for the first time - we show only the welcome modal, nothing else -->

  <script>
    window.addEventListener("DOMContentLoaded", () => {
      const modal = new bootstrap.Modal(document.getElementById("welcomeModal"));
      modal.show();
    });
  </script>

  <div class="modal fade show" id="welcomeModal" tabindex="-1" aria-labelledby="welcomeModalLabel" aria-modal="true" style="display: block;">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="welcomeModalLabel">ðŸ‘‹ Welcome to RentTracker!</h5>
        </div>
        <div class="modal-body">
          Start by adding your first <strong>Apartment</strong> and assigning a <strong>Tenant</strong>.<br><br>
          Once added, RentTracker will show unpaid rents and send reminders!
        </div>
        <div class="modal-footer">
        <ol>
          <li><a href="{{ url_for('apartments.list_apartments') }}" class="btn btn-primary">Add Apartment</a></li>
          <li><a href="{{ url_for('tenants.list_tenants') }}" class="btn btn-secondary">Add Tenant</a></li>
          <li><a href="{{ url_for('rental_agreements.list_rental_agreements') }}" class="btn btn-primary">Add Rental Agreement</a></li>
        </ol>
          
        </div>
      </div>
    </div>
  </div>

  <div class="modal-backdrop fade show"></div>

{% else %}
  <!-- If not first time here - we show normal dashboard -->

<h2>Cash-Flow Projection</h2>
<table>
  <tr>
    <th>Month</th>
    <th>Expected Income</th>
    <th>Collected Income</th>
    <th>Missing Income</th>
  </tr>
  {% for row in projection %}
  <tr>
    <td>{{ row.month }}</td>
    <td>{{ row.expected }}â‚¬</td>
    <td>{{ row.collected }}â‚¬</td>
    <td>{{ row.missing }}â‚¬</td>
  </tr>
  {% endfor %}
</table>

  <div class="summary-boxes">
  <div class="summary-box">
    <h3>Total Apartments</h3>
    <p>{{ total_apartments }}</p>
  </div>
  <div class="summary-box">
    <h3>Active Agreements</h3>
    <p>{{ active_agreements }}</p>
  </div>
</div>

<h3>ðŸ”” Upcoming/Unpaid Rent Overview</h3>

{% if upcoming_unpaid %}
  <table border="1" cellpadding="8" cellspacing="0">
    <thead>
      <tr>
        <th>Apartment</th>
        <th>Tenant</th>
        <th>Months to Pay</th>
        <th>Total Due</th>
      </tr>
    </thead>
    <tbody>
      {% for entry in upcoming_unpaid %}
      <tr>
        <td>{{ entry.apartment_name }}</td>
        <td>{{ entry.tenant_name }}</td>
        <td>
          {% for m in entry.months %}
            <span>{{ m }}</span>{% if not loop.last %}, {% endif %}
          {% endfor %}
        </td>
        <td><strong>{{ entry.total_due }}</strong></td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
{% else %}
  <p>âœ… All rents appear to be paid for the relevant periods.</p>
{% endif %}

{% endif %}
{% endblock %}


